{% extends "base.html" %}

{% block title %}Admin - Gerenciar Lista{% endblock %}

{% block content %}
<div class="min-h-screen py-6 px-4 bg-gray-50">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-2xl shadow-md p-6 mb-6">
            <h1 class="text-2xl md:text-3xl font-bold text-text-dark mb-2">
                üîß Gerenciar Lista
            </h1>
            <p class="text-text-gray">
                Admin / Organizador Screen (Minimal)
            </p>
            <p class="text-sm text-red-600 mt-2">
                ‚ö†Ô∏è Esta p√°gina √© apenas para administradores. Guarde o link com seguran√ßa.
            </p>
        </div>
        
        <!-- Reserved Items Summary -->
        {% set reserved_items = items|selectattr('status', 'equalto', 'reserved')|list %}
        {% if reserved_items %}
        <div class="bg-white rounded-2xl shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold text-text-dark mb-4">üéÅ Quem Reservou o Qu√™ ({{ reserved_items|length }} itens reservados)</h2>
            
            <div class="space-y-3">
                {% for item in reserved_items %}
                <div class="flex items-center justify-between p-4 bg-yellow-50 border border-yellow-200 rounded-xl">
                    <div class="flex-1">
                        <p class="font-semibold text-text-dark">{{ item['name'] }}</p>
                        <p class="text-sm text-gray-600">{{ item['category'] }}</p>
                    </div>
                    <div class="flex items-center gap-2 bg-white px-4 py-2 rounded-full border border-yellow-300">
                        <span class="text-lg">üë§</span>
                        <span class="font-medium text-gray-800">{{ item['reserved_by'] }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% else %}
        <div class="bg-white rounded-2xl shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold text-text-dark mb-4">üéÅ Quem Reservou o Qu√™</h2>
            <p class="text-center text-gray-500 py-8">Nenhum item reservado ainda.</p>
        </div>
        {% endif %}
        
        <!-- Add new item -->
        <div class="bg-white rounded-2xl shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold text-text-dark mb-4">‚ûï Adicionar Novo Item</h2>
            
            <form method="POST" action="{{ url_for('admin_add_item') }}" class="space-y-4">
                <input type="hidden" name="admin_key" value="{{ admin_key }}">
                
                <div>
                    <label class="block text-sm font-medium text-text-dark mb-2">Nome do Item *</label>
                    <input 
                        type="text" 
                        name="name" 
                        required
                        placeholder="Ex: Conjunto de Panelas"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                    >
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-text-dark mb-2">Categoria *</label>
                    <select 
                        name="category" 
                        required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                    >
                        <option value="">Selecione...</option>
                        <option value="Cozinha">Cozinha</option>
                        <option value="Quarto">Quarto</option>
                        <option value="Banheiro">Banheiro</option>
                        <option value="Limpeza">Limpeza</option>
                        <option value="Lavanderia">Lavanderia</option>
                        <option value="Sala">Sala</option>
                        <option value="Outros">Outros</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-text-dark mb-2">Notas / Descri√ß√£o</label>
                    <textarea 
                        name="notes" 
                        rows="3"
                        placeholder="Detalhes adicionais, cor, tamanho, marca sugerida..."
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                    ></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-text-dark mb-2">Link de Sugest√£o de Loja (opcional)</label>
                    <input 
                        type="url" 
                        name="suggestion_link" 
                        placeholder="https://www.magazineluiza.com.br/produto..."
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                    >
                    <p class="text-xs text-gray-500 mt-1">üí° Cole aqui o link de onde os convidados podem encontrar o produto</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-text-dark mb-2">URL da Imagem (opcional)</label>
                    <input 
                        type="url" 
                        name="image_url" 
                        placeholder="https://exemplo.com/imagem.jpg"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                    >
                    <p class="text-xs text-gray-500 mt-1">üí° Cole aqui a URL da imagem do produto. Se deixar vazio, ser√° usado o √≠cone padr√£o da categoria.</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-text-dark mb-2">Pre√ßo Estimado (R$)</label>
                    <input 
                        type="number" 
                        name="price_estimate" 
                        placeholder="Ex: 150"
                        min="0"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                    >
                    <p class="text-xs text-gray-500 mt-1">üí° Valor aproximado para ajudar os convidados a filtrar por faixa de pre√ßo</p>
                </div>
                
                <button 
                    type="submit"
                    class="w-full bg-primary hover:bg-primary-dark text-white font-semibold py-3 px-6 rounded-lg transition duration-200"
                >
                    Adicionar Item
                </button>
            </form>
        </div>
        
        <!-- Statistics -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="bg-white rounded-xl shadow-md p-4 border-l-4 border-green-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Dispon√≠veis</p>
                        <p class="text-2xl font-bold text-green-600">
                            {{ items|selectattr('status', 'equalto', 'available')|list|length }}
                        </p>
                    </div>
                    <div class="text-3xl">‚úÖ</div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-4 border-l-4 border-yellow-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Reservados</p>
                        <p class="text-2xl font-bold text-yellow-600">
                            {{ items|selectattr('status', 'equalto', 'reserved')|list|length }}
                        </p>
                    </div>
                    <div class="text-3xl">‚è≥</div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-4 border-l-4 border-blue-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">J√° temos</p>
                        <p class="text-2xl font-bold text-blue-600">
                            {{ items|selectattr('status', 'equalto', 'owned')|list|length }}
                        </p>
                    </div>
                    <div class="text-3xl">üíö</div>
                </div>
            </div>
        </div>
        
        <!-- List all items -->
        <div class="bg-white rounded-2xl shadow-md p-6">
            <h2 class="text-xl font-bold text-text-dark mb-4">üìã Todos os Itens ({{ items|length }} total)</h2>
            
            <div class="space-y-4">
                {% for item in items %}
                <div class="border border-gray-200 rounded-xl p-4">
                    <form method="POST" action="{{ url_for('admin_edit_item', item_id=item['id']) }}" class="space-y-3">
                        <input type="hidden" name="admin_key" value="{{ admin_key }}">
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">Nome</label>
                                <input 
                                    type="text" 
                                    name="name" 
                                    value="{{ item['name'] }}"
                                    required
                                    class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                                >
                            </div>
                            
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">Categoria</label>
                                <select 
                                    name="category" 
                                    required
                                    class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                                >
                                    <option value="Cozinha" {% if item['category'] == 'Cozinha' %}selected{% endif %}>Cozinha</option>
                                    <option value="Quarto" {% if item['category'] == 'Quarto' %}selected{% endif %}>Quarto</option>
                                    <option value="Banheiro" {% if item['category'] == 'Banheiro' %}selected{% endif %}>Banheiro</option>
                                    <option value="Limpeza" {% if item['category'] == 'Limpeza' %}selected{% endif %}>Limpeza</option>
                                    <option value="Lavanderia" {% if item['category'] == 'Lavanderia' %}selected{% endif %}>Lavanderia</option>
                                    <option value="Sala" {% if item['category'] == 'Sala' %}selected{% endif %}>Sala</option>
                                    <option value="Outros" {% if item['category'] == 'Outros' %}selected{% endif %}>Outros</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Notas</label>
                            <textarea 
                                name="notes" 
                                rows="2"
                                class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                            >{{ item['notes'] or '' }}</textarea>
                        </div>
                        
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Link de Sugest√£o de Loja</label>
                            <input 
                                type="url" 
                                name="suggestion_link" 
                                value="{{ item['suggestion_link'] or '' }}"
                                placeholder="https://www.loja.com.br/produto..."
                                class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">URL da Imagem</label>
                            <input 
                                type="url" 
                                name="image_url" 
                                value="{{ item['image_url'] or '' }}"
                                placeholder="https://exemplo.com/imagem.jpg"
                                class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                            >
                            {% if item['image_url'] %}
                            <div class="mt-2">
                                <img src="{{ item['image_url'] }}" alt="Preview" class="max-w-32 max-h-32 rounded-lg border border-gray-200">
                            </div>
                            {% endif %}
                        </div>
                        
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Pre√ßo Estimado (R$)</label>
                            <input 
                                type="number" 
                                name="price_estimate" 
                                value="{{ item['price_estimate'] or '' }}"
                                placeholder="Ex: 150"
                                min="0"
                                class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                            >
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">Status</label>
                                <select 
                                    name="status"
                                    class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                                >
                                    <option value="available" {% if item['status'] == 'available' %}selected{% endif %}>Dispon√≠vel</option>
                                    <option value="reserved" {% if item['status'] == 'reserved' %}selected{% endif %}>Reservado</option>
                                    <option value="owned" {% if item['status'] == 'owned' %}selected{% endif %}>J√° temos</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">Reservado por</label>
                                <div class="flex items-center gap-2">
                                    {% if item['reserved_by'] %}
                                        <span class="px-3 py-2 text-sm font-medium text-green-700 bg-green-50 border border-green-200 rounded-lg flex-1">
                                            üë§ {{ item['reserved_by'] }}
                                        </span>
                                    {% else %}
                                        <span class="px-3 py-2 text-sm text-gray-400 bg-gray-50 border border-gray-200 rounded-lg flex-1">
                                            N/A
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex gap-2 pt-2">
                            <button 
                                type="submit"
                                class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg text-sm transition duration-200"
                            >
                                üíæ Salvar
                            </button>
                            
                            <button 
                                type="button"
                                onclick="deleteItem({{ item['id'] }}, '{{ admin_key }}')"
                                class="bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-4 rounded-lg text-sm transition duration-200"
                            >
                                üóëÔ∏è Excluir
                            </button>
                        </div>
                    </form>
                </div>
                {% endfor %}
                
                {% if not items %}
                <p class="text-center text-text-gray py-8">Nenhum item cadastrado.</p>
                {% endif %}
            </div>
        </div>
        
        <!-- Back to home -->
        <div class="mt-6 text-center">
            <a href="{{ url_for('home') }}" class="inline-flex items-center text-primary hover:text-primary-dark font-medium">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                </svg>
                Voltar para o site
            </a>
        </div>
    </div>
</div>

<script>
    function deleteItem(itemId, adminKey) {
        if (!confirm('Tem certeza que deseja excluir este item? Esta a√ß√£o n√£o pode ser desfeita.')) {
            return;
        }
        
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/admin/delete/' + itemId;
        
        const keyInput = document.createElement('input');
        keyInput.type = 'hidden';
        keyInput.name = 'admin_key';
        keyInput.value = adminKey;
        
        form.appendChild(keyInput);
        document.body.appendChild(form);
        form.submit();
    }
</script>
{% endblock %}
